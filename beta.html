<!doctype html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Cyber Music Studio (beta)</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Severák's Cyber Music Studio" />
	<meta property="og:image" content="https://severak.github.io/cyber-music-studio/img/preview.png" />
	<meta property="og:type" content="website" />
	<meta property="og:description" content="not your usual DAW" />
	<link rel="stylesheet" href="css/uboot.css">
	
	<script src="js/uboot.js"></script>
<script src="js/JZZ.js"></script>
<script src="js/JZZ.input.Kbd.js"></script>
<script src="js/JZZ.gui.Select.js"></script>
<script src="js/JZZ.synth.Severak.js"></script>
<script src="js/wavy-jones.js"></script>
<script src="js/heartbeat.js"></script>
<style>
body {
	font-family: "Lucida Console", monospace;
	background-color: plum;
}

.ub-box {
	background-color: lightyellow;
}

button.on {
	background-color: yellow;
}

#scope {
	padding: 0;
    width: 100%;
	height: 80px;
	background-color: #000;
}
</style>
<script>if(!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!== 0){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"severak",utcoffset:"1"}))};sessionStorage.setItem("_swa","1");</script>
</head>
<body>

<div class="ub-container">
<h1>Cyber Music Studio™ <small>beta</small></h1>

<form class="ub-form" id="form">

<div class="ub-box" id="box_welcome">
<img src="img/preview.png" class="ub-fit-img">
<p>This is beta version of Cyber Music Studio™. It's not finished yet and can be broken at any moment.</p>
<p>Feel free to test it and report bugs <a href="https://github.com/severak/cyber-music-studio/issues" target="_blank">here</a>.</p>
<center><button id="power"><big>OK</big></button></center>
</div>
<br><br>

<div class="ub-box ub-hidden" id="box_traveller" style="background-color: silver">

<div class="ub-cols">
<div class="ub-same">
<h2>traveller</h2>
</div>
<div style="text-align: right;" class="ub-same">
<small>flexible monosynth</small>
</div>
</div>


<div class="ub-cols">
    <div class="ub-same">
        LFO
        <select id="lfo">
            <option name="sine">sine</option>
            <option name="triangle">triangle</option>
            <option name="square">square</option>
            <option name="sawtooth" selected>sawtooth</option>
        </select>
    </div>
    <div class="ub-same">
        rate <input type="range" min="0.30" max="30" step="0.25" value="5" id="rate">
    </div>
    <div class="ub-same">
        amp <input type="range" min="0" max="1" step="0.01" value="0" id="amp">
    </div>
    <div class="ub-same">
        vcf <input type="range" min="0" max="1" step="0.01" value="0" id="vcf">
    </div>
</div>

<div class="ub-cols">
<div class="ub-same">
vol <input type="range" min="0" max="0.5" step="0.01" value="0.25" id="vol">
</div>
<div class="ub-same">
waveform:
<select id="wave">
<option name="sine">sine</option>
<option name="triangle">triangle</option>
<option name="square">square</option>
<option name="sawtooth" selected>sawtooth</option>
<option name="arp" disabled>arp</option>
<option name="pwm" disabled>pwm</option>
<option name="noise" disabled>noise</option>
<option name="tonal noise" disabled>tonal noise</option>
</select>
</div>
<div class="ub-same">
attack
<input type="range" min="0.01" max="1" step="0.1" value="0.2" id="attack">
</div>
<div class="ub-same">
decay
<input type="range" min="0.01" max="1" step="0.1" value="0.5" id="decay">
</div>
</div>

<div class="ub-cols">
<div class="ub-same">
<label><input type="checkbox" id="hold" checked> hold</label>
</div>
<div class="ub-same">
<label><input type="checkbox" id="bite"> bite</label>
</div>
<div class="ub-same">
<label><input type="checkbox" id="quack"> quack</label>
</div>
</div>

<div class="ub-cols">
<div class="ub-same">
TRAVELLER
<input type="range" min="0" max="22000" value="22000" id="traveller">
</div>
</div>

<div class="ub-cols">
<div class="ub-same"  style="text-align: center">
<div id="keyboard"></div>
</div>
</div>

<div class="ub-cols">
<div class="ub-same" style="text-align: center">
MIDI input: <select id="select_midi_in"></select> <!-- | <button id="record">record</button> -->
</div>
</div>

</div>

<br><br>

<div class="ub-box ub-hidden" style="background-color: coral" id="box_nomad">

<div class="ub-cols">
<div class="ub-same">
<h2>analog nomad</h2>
</div>
<div style="text-align: right;" class="ub-same">
<small>Juno-like polysynth</small><br>
	<input type="range" min="0" max="1" value="0.5" step="0.05" id="n_vol"> vol
</div>
</div>

<div class="ub-cols">
<div class="ub-same">
pulse <input type="range" min="0" max="0.3" step="0.1" value="0.25" id="pulse">
</div>
<div class="ub-same">
saw <input type="range" min="0" max="0.3" step="0.1" value="0.25" id="saw">
</div>
<div class="ub-same">
sub <input type="range" min="0" max="0.3" step="0.1" value="0.25" id="sub">
</div>
<div class="ub-same">
noise <input type="range" min="0" max="0.3" value="0" step="0.05" id="noise">
</div>
</div>

<div class="ub-cols">
<div class="ub-same">
A <input type="range" min="0.01" max="1" step="0.01" value="0.01" id="A">
</div>
<div class="ub-same">
D <input type="range" min="0.01" max="1" step="0.01" value="0.25" id="D">
</div>
<div class="ub-same">
S <input type="range" min="0" max="1" step="0.1" value="0.8" id="S">
</div>
<div class="ub-same">
R <input type="range" min="0.01" max="1" step="0.1" value="0.5" id="R">
</div>
</div>


<div class="ub-cols">
<div class="ub-same">
<label><input type="checkbox" id="n_quack" checked> quack</label>
</div>
<div class="ub-same">
FREQ <input type="range" min="30" max="22000" step="1" value="8000" id="n_freq">
</div>
<div class="ub-same">
Q <input type="range" min="0" max="10" step="0.1" value="5" id="n_resonance">
</div>
</div>

<div class="ub-cols">
<div class="ub-same"  style="text-align: center">
<div id="keyboard2"></div>
</div>
</div>

<div class="ub-cols">
<div class="ub-same" style="text-align: center">
MIDI input: <select id="select_midi_in2"></select> <!-- | <button id="record" disabled>record</button> -->
</div>
</div>

</div>

<br><br>
<div id="scope" class="ub-box ub-hidden"></div>

</form>


<script>
function keyboardMidiWrap(keyboardElemId, midiSelectorId, synth) {
    // set up routing from external MIDI via HTML keyboard to synth itself
    var kbd = JZZ.input.Kbd({ at:keyboardElemId, pos:'N', wl: 50, ww:21, bl: 25, bw:12, from:'F4', to:'C7' });
    var midiIn = JZZ.gui.SelectMidiIn({ at: midiSelectorId });
    var wrap = JZZ.synth.Severak();
    wrap.setSynth(synth);
    kbd.connect(wrap);

    // handles all the selection stuff
    midiIn.onSelect = function(name) {
        JZZ().openMidiIn(name).and(function () {
            if (kbd.currentExternal) kbd.currentExternal.disconnect(kbd);
            this.connect(kbd);
            kbd.currentExternal = this;
        }).or(function () {
            if (kbd.currentExternal) kbd.currentExternal.disconnect(kbd);
        });
    };
}

ub.on("power","click",  function(ev){
	ub.stop(ev);
	ub.addClass("box_welcome", 'ub-hidden');
	ub.delClass("box_traveller", 'ub-hidden');
	ub.delClass("box_nomad", 'ub-hidden');
	ub.delClass("scope", 'ub-hidden');

	ub.gebi('form').reset();
	hb.start();
	
	window.traveller = hb.Traveller();
	hb.chnget(traveller, "vol");
	hb.chnget(traveller, "wave");
	hb.chnget(traveller, "attack");
	hb.chnget(traveller, "decay");
	hb.chnget(traveller, "hold");
	hb.chnget(traveller, "bite");
	hb.chnget(traveller, "quack");
	hb.chnget(traveller, "traveller");
	hb.chnget(traveller, "lfo");
	hb.chnget(traveller, "rate");
	hb.chnget(traveller, "amp");
	hb.chnget(traveller, "vcf");

	keyboardMidiWrap('keyboard', 'select_midi_in', traveller);
	
	window.nomad = hb.AnalogNomad();
	hb.chnget(nomad, 'vol', 'n_vol');
	hb.chnget(nomad, 'saw');
	hb.chnget(nomad, 'pulse');
	hb.chnget(nomad, 'sub');
	hb.chnget(nomad, 'noise');
	hb.chnget(nomad, 'attack', 'A');
	hb.chnget(nomad, 'decay', 'D');
	hb.chnget(nomad, 'sustain', 'S');
	hb.chnget(nomad, 'release', 'R');
	hb.chnget(nomad, 'release', 'R');
	hb.chnget(nomad, 'quack', 'n_quack');
	hb.chnget(nomad, 'filter', 'n_freq');
	hb.chnget(nomad, 'resonance', 'n_resonance');

    keyboardMidiWrap('keyboard2', 'select_midi_in2', nomad);

	var oscope = new WavyJones(hb.ac, 'scope');
	oscope.lineColor = '#00ff00';
	oscope.lineThickness = 2;
	traveller._vol.connect(oscope);
	nomad._vol.connect(oscope);

	// TODO - single' Cycle Sampler
    function _base64ToArrayBuffer(base64) {
        var binary_string = window.atob(base64);
        var len = binary_string.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes.buffer;
    }

	var violin = 'UklGRsACAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YZwCAABGAFAAZQBpAGsAYQBdAG4AXQBjABAAbgC4AL4AtgDEALUAsAC4AOQAJgErAf4AJwFWATsDfgThATD9d/gG9aXykPFL8T7xivEH8ofyQvPV8030GPXf9ZL2z/Yb95/3Wfjr+F75z/ks+sX69vpT+8r7Qvy9/CL9Qf2p/SP+hP64/hH/R/93/9n/YAB2AJ4AzQAhAZoBuQHSAS0CQQJnAq0CAwNhA6EDmwPCA+gDGwRKBGAEiAS8BKkE2AQ0BTcFRAVqBUIFkgXbBbcF1gXSBdcFAAYBBukF4QUEBrcEMwLrAxkKTBGlFjoaXRxxHbMdcx0FHXIcXBuqGvAZJhlbGJwX5RYQFmEVsBTfEyMTOxK0ESwRTxDDDzEPnw76DW8N9gw/DFQLNQuyClUK2AlBCb0IQgjSBzgHsQaHBiMGpQVWBf0ErQQbBKoDYwPcAo0CUQIQAq0BhgEtAdcArwAYALr/gP9p/1H/v/52/nf+NP7P/aH9m/1Q/e/82vzu/Jz8XfxA/O/7c/yA/Az73fgz9wT23PQu9LTziPOO87nzs/PX8wD0HvQ69Ev0uvTS9On0/PQ89Uv1ifWQ9cH1BfYg9k72SvaW9rr21vYA9xn3I/dB93/3s/fL99f32/f/9w/4X/iY+Nz49PjT+Pv4FflA+X35fvmt+dL5GvoV+vX5Gfo4+iL6Wfqx+rL6xfrm+vD6JPtJ+3b7lfua+5D7hvuH+5j75PsJ/BL8MvyY/I/8h/zT/Cj9K/3z/Gn9Sf1A/Uz9UP1p/Zj9i/2N/aP9zP0G/mb+H/4e/mX+Vv4X/hT+Kv5B/kz+q/6n/vf+7P7r/vD+Cv/+/jT/Nv8u/zX/cP96/4T/fP+q/8f/4f+u/4j/lv/A/9D/7/9BAG8ANgAFAA==';
    hb.ac.decodeAudioData(_base64ToArrayBuffer(violin), function (buffer) {
        window.violinSample = buffer;
        // traveller._osc.disconnect(traveller._vcf);
        // traveller._osc = hb.makeSamplerOsc(buffer, 440);
        // traveller._osc.connect(traveller._vcf);
    });

});
</script>

</div>

</body>
</html>
